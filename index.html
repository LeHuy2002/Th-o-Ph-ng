<!DOCTYPE html>
<html>
<head>
    <title>Chúc mừng sinh nhật em yêu
    <br>
    Thảo Phương!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Pacifico', cursive;
            overflow-x: hidden;
            padding: 20px;
            box-sizing: border-box;
            position: relative; /* Để container pháo giấy có thể định vị tuyệt đối */
            border: 5px solid transparent; /* Viền ban đầu trong suốt */
            border-image-slice: 1; /* Để border-image phủ toàn bộ viền */
        }

        .birthday-container {
            text-align: center;
            position: relative;
            background-color: rgba(255, 255, 255, 0.6);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            max-width: 90%;
            z-index: 1; /* Đảm bảo nội dung hiển thị trên pháo giấy */
        }

        h1 {
            font-size: clamp(1.5em, 5vw, 3em);
            color: #e91e63;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            animation: fadeIn 2s ease-in-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-50px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .date {
            font-size: clamp(1.2em, 4vw, 1.8em);
            color: #9c27b0;
            margin-bottom: 30px;
            animation: slideIn 2s ease-in-out;
        }

        @keyframes slideIn {
            0% { opacity: 0; transform: translateX(-50px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .message {
            font-size: clamp(1em, 3vw, 1.2em);
            color: #555;
            margin-top: 30px;
            animation: fadeInUp 2s ease-in-out;
            line-height: 1.6;
        }

        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(50px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .fireworks-container, .balloons-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .firework {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            animation: firework-explode 1.5s ease-out forwards;
            opacity: 0;
        }

        @keyframes firework-explode {
            0% { transform: scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: scale(1.5) translate(0, -20px); opacity: 0; }
        }

        .balloon {
            position: absolute;
            width: 30px;
            height: 40px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0.7;
            animation: balloon-float 5s linear infinite;
        }

        @keyframes balloon-float {
            0% { transform: translateY(100vh) rotate(0deg); }
            50% { transform: rotate(10deg); }
            100% { transform: translateY(-100px) rotate(-10deg); }
        }

        .heart {
          position: fixed;
          width: 50px;
          height: 50px;
          background-color: red;
          transform: rotate(-45deg);
          animation: heartbeat 1.5s ease infinite;
          opacity: 0.5;
          z-index: -1;
        }
        .heart::before,
        .heart::after {
          content: "";
          position: absolute;
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background-color: red;
        }
        .heart::before {
          top: -25px;
          left: 0;
        }
        .heart::after {
          top: 0;
          left: 25px;
        }
        @keyframes heartbeat {
            0% { transform: rotate(-45deg) scale(1); }
            25% { transform: rotate(-45deg) scale(1.1); }
            50% { transform: rotate(-45deg) scale(1); }
            75% { transform: rotate(-45deg) scale(1.1); }
            100% { transform: rotate(-45deg) scale(1); }
        }

        .heart.top-left { top: 15%; left: 10%; }
        .heart.top-right { top: 15%; right: 10%; }
        .heart.bottom-left { bottom: 15%; left: 10%; }
        .heart.bottom-right { bottom: 15%; right: 10%; }

        #music-button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            background-color: #f44336;
            color: white;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease;
        }

        #music-button:hover {
            background-color: #d32f2f;
        }

        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #fce18a;
            border-radius: 5px;
            opacity: 0;
            animation: confetti-fall 5s ease-out forwards, confetti-rotate 3s ease-in-out infinite;
            transform-origin: center center;
        }

        @keyframes confetti-fall {
            0% { transform: translate(-50%, -50%) translateY(-100%); opacity: 1; }
            100% { transform: translate(-50%, -50%) translateY(110%); opacity: 0.7; }
        }

        @keyframes confetti-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Стиль cho dảy đèn chớp */
        .light-string {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -3; /* Phía sau các hiệu ứng khác */
        }

        .light-bulb {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #ccc;
            opacity: 0.8;
            transition: background-color 0.1s ease-in-out;
        }

        .light-bulb.on {
            /* Màu sắc khi nháy */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
</head>
<body>

<div class="birthday-container">
    <h1>Chúc mừng sinh nhật tình em yêu của anh
        <br>Thảo Phương!</h1>
    <p class="date">Ngày 11 tháng 8 năm 2008
    <br> Ngày mà một thiên thần nhỏ được sinh ra!</p>
    <p class="message">
        Anh không thể tưởng tượng cuộc sống của mình sẽ như thế nào nếu không có em. Em là ánh sáng của cuộc đời anh, người bạn thân nhất và là người yêu tuyệt vời nhất. Chúc em một ngày thật đặc biệt và một năm đầy ắp những khoảnh khắc hạnh phúc bên nhau.
    </p>

    <button id="music-button">Bật nhạc & Pháo sáng!</button>

</div>

<div class="fireworks-container"></div>
<div class="balloons-container"></div>
<div class="confetti-container"></div>
<div class="light-string">
    </div>

<div class="heart top-left"></div>
<div class="heart top-right"></div>
<div class="heart bottom-left"></div>
<div class="heart bottom-right"></div>


<script>
    // --- Pháo hoa ---
    const fireworksContainer = document.querySelector('.fireworks-container');
    function createFirework() {
        if (!fireworksContainer) return;
        const firework = document.createElement('div');
        firework.classList.add('firework');
        firework.style.left = Math.random() * 100 + 'vw';
        firework.style.top = Math.random() * 70 + 'vh';
        firework.style.backgroundColor = ['#ffc107', '#e91e63', '#9c27b0', '#ffffff'][Math.floor(Math.random() * 4)];
        firework.style.animationDelay = Math.random() * 0.5 + 's';
        fireworksContainer.appendChild(firework);

        setTimeout(() => {
            firework.remove();
        }, 1500 + Math.random() * 500);
    }

    function createFireworkBurst() {
        for (let i = 0; i < 20; i++) { // Giảm số lượng pháo hoa trong mỗi lần nổ để tránh quá tải
            setTimeout(() => {
                createFirework();
            }, Math.random() * 500);
        }
    }

    // Tạo pháo hoa ban đầu và sau đó theo khoảng thời gian (khi trang tải)
    for(let i=0; i<5; i++) { setTimeout(createFirework, Math.random() * 1000); }
    setInterval(createFirework, 1000); // Giảm tần suất pháo hoa liên tục

    // --- Bóng bay ---
    const balloonsContainer = document.querySelector('.balloons-container');
    function createBalloon() {
        if (!balloonsContainer) return;
        const balloon = document.createElement('div');
        balloon.classList.add('balloon');
        balloon.style.left = Math.random() * 95 + 'vw';
        balloon.style.backgroundColor = ['#ffc107', '#e91e63', '#9c27b0', '#8bc34a', '#03a9f4'][Math.floor(Math.random() * 5)];
        balloon.style.animationDuration = Math.random() * 3 + 5 + 's';
        balloonsContainer.appendChild(balloon);

        setTimeout(() => {
            balloon.remove();
        }, 8000);
    }
     // Tạo bóng bay ban đầu và sau đó theo khoảng thời gian
    for(let i=0; i<5; i++) { setTimeout(createBalloon, Math.random() * 1000); }
    setInterval(createBalloon, 1000);

    // --- Pháo giấy (Confetti) ---
    const confettiContainer = document.querySelector('.confetti-container');
    function createConfetti() {
        if (!confettiContainer) return;
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = Math.random() * 100 + 'vh';
        confetti.style.backgroundColor = ['#fce18a', '#ff726d', '#b48adf', '#ffffff', '#5abeff'][Math.floor(Math.random() * 5)];
        const size = Math.random() * 8 + 6;
        confetti.style.width = size + 'px';
        confetti.style.height = size + 'px';
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confettiContainer.appendChild(confetti);

        setTimeout(() => {
            confetti.remove();
        }, 5000);
    }

    function createConfettiBurst() {
        for (let i = 0; i < 50; i++) { // Giảm số lượng confetti mỗi lần nổ
            setTimeout(createConfetti, Math.random() * 500);
        }
    }

    // --- Âm nhạc và nút điều khiển ---
    const musicButton = document.getElementById('music-button');
    const audioElement = new Audio('birthday.mp3');
    const bodyElement = document.querySelector('body');
    const lightStringContainer = document.querySelector('.light-string');
    let isPlaying = false;
    let fireworkInterval;
    let confettiInterval;
    let audioContext;
    let analyser;
    let dataArray;
    const beatThreshold = 20; // Ngưỡng phát hiện nhịp (có thể cần điều chỉnh)
    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#800080', '#008000']; // Mảng màu
    let colorIndex = 0;
    const numLights = 60; // Số lượng đèn trong dảy
    let lightBulbs = [];

    // Tạo dảy đèn
    for (let i = 0; i < numLights; i++) {
        const light = document.createElement('div');
        light.classList.add('light-bulb');
        lightBulbs.push(light);
        lightStringContainer.appendChild(light);
    }

    function positionLights() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        const bulbSize = 15;
        let index = 0;

        // Top border
        for (let i = bulbSize / 2; i < width - bulbSize / 2; i += width / (numLights / 4)) {
            if (index < numLights) {
                lightBulbs[index].style.left = `px`;
                lightBulbs[index].style.top = `px`;
                index++;
            }
        }

        // Right border
        for (let i = bulbSize / 2 + width / (numLights / 4); i < height - bulbSize / 2 - width / (numLights / 4); i += height / (numLights / 4)) {
            if (index < numLights) {
                lightBulbs[index].style.left = `px`;
                lightBulbs[index].style.top = `px`;
                index++;
            }
        }

        // Bottom border
        for (let i = width - bulbSize / 2 - width / (numLights / 4); i > bulbSize / 2; i -= width / (numLights / 4)) {
            if (index < numLights) {
                lightBulbs[index].style.left = `px`;
                lightBulbs[index].style.top = `px`;
                index++;
            }
        }

        // Left border
        for (let i = height - bulbSize / 2 - width / (numLights / 4); i > bulbSize / 2 + width / (numLights / 4); i -= height / (numLights / 4)) {
            if (index < numLights) {
                lightBulbs[index].style.left = `px`;
                lightBulbs[index].style.top = `px`;
                index++;
            }
        }
    }

    positionLights();
    window.addEventListener('resize', positionLights);

    function initAudioAnalysis() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const source = audioContext.createMediaElementSource(audioElement);
            analyser = audioContext.createAnalyser();
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            analyser.fftSize = 64;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
        }
    }

    function analyzeAudio() {
        if (!isPlaying || !analyser) return;

        analyser.getByteTimeDomainData(dataArray);
        let sum = 0;
        for (let i = 0; i < dataArray.length; i++) {
            sum += Math.abs(dataArray[i] - 128);
        }
        const average = sum / dataArray.length;

        if (average > beatThreshold) {
            lightBulbs.forEach((light, index) => {
                const delay = index * 20; // Tạo độ trễ nhỏ giữa các đèn
                setTimeout(() => {
                    light.style.backgroundColor = colors[(colorIndex + index) % colors.length];
                    setTimeout(() => {
                        light.style.backgroundColor = '#ccc'; // Tắt đèn sau một khoảng thời gian ngắn
                    }, 80);
                }, delay);
            });
            colorIndex = (colorIndex + 1) % colors.length; // Chuyển sang màu tiếp theo
        }
    }

    musicButton.addEventListener('click', function() {
        if (audioElement.paused) {
            audioElement.play();
            isPlaying = true;
            musicButton.textContent = 'Tắt nhạc & Pháo sáng!';
            initAudioAnalysis();
            fireworkInterval = setInterval(createFireworkBurst, 3000);
            confettiInterval = setInterval(createConfettiBurst, 1500);
            requestAnimationFrame(function animate() {
                analyzeAudio();
                if (isPlaying) {
                    requestAnimationFrame(animate);
                } else {
                    bodyElement.style.borderImage = 'initial';
                    lightBulbs.forEach(light => light.style.backgroundColor = '#ccc');
                    colorIndex = 0;
                }
            });
        } else {
            audioElement.pause();
            isPlaying = false;
            musicButton.textContent = 'Bật nhạc & Pháo sáng!';
            bodyElement.classList.remove('music-playing');
            clearInterval(fireworkInterval);
            clearInterval(confettiInterval);
            bodyElement.style.borderImage = 'initial';
            lightBulbs.forEach(light => light.style.backgroundColor = '#ccc');
            colorIndex = 0;
        }
    });

    // Phát nhạc tự động nếu trình duyệt hỗ trợ
    audioElement.autoplay = true;
    audioElement.loop = true;

    // Kiểm tra nếu autoplay bị chặn, hiển thị nút bật nhạc
    if (audioElement.autoplay) {
        audioElement.play().catch(error => {
            console.log("Autoplay bị chặn:", error);
            musicButton.style.display = 'block';
        });
    } else {
        musicButton.style.display = 'block';
    }

</script>

</body>
</html>
